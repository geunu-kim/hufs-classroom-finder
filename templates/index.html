<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <meta charset="UTF-8">
  <title>HUFSpace</title>
  <link rel="icon" href="/static/Symbol.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="/static/manifest-v2.json">
  <style>
    @font-face {
        font-family: 'HUFSFont';
        src: url('/static/HUFSFontM.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background-image: url('https://i.pinimg.com/736x/55/b8/5c/55b85c12335b0b2fcdcbb49acfb025ae.jpg'); /* User's newest preferred image */
      background-size: cover;
      background-position: center;
      font-family: 'HUFSFont', 'Noto Sans KR', sans-serif; /* Apply the new font */
      color: white;
    }

    /* .background-img removed */

    /* .bg-blur removed */

    .overlay {
      background: transparent; /* Removed dark overlay */
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }

    .content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 40px 20px;
      text-align: center;
    }

    h1 {
      font-size: 48px;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      color: rgb(0, 45, 86); /* HUFS NAVY */
    }
    .gold-text {
      color: rgb(141, 113, 80); /* HUFS GOLD */
    }
    .semester-text {
      display: block;
      margin-top: 5px; /* Adjust as needed */
    }

    p.subtitle {
      font-size: 18px;
      margin-bottom: 20px;
      opacity: 0.9;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
      color: rgb(0, 45, 86); /* HUFS NAVY */
      font-weight: 700; /* Make it bolder */
    }

    .search-container {
      background: rgba(255, 255, 255, 0.95); /* Slightly less transparent */
      color: #333;
      border-radius: 20px; /* Slightly more rounded */
      padding: 30px 40px; /* More padding */
      width: 100%;
      max-width: 900px;
      box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.2); /* Softer, larger shadow */
      backdrop-filter: blur(5px); /* Add a subtle blur effect */
      margin-bottom: 20px; /* Added spacing */
    }
    
    .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        align-items: flex-end;
        margin-bottom: 1.5rem;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        text-align: left;
    }

    .control-group label {
        font-weight: 700;
        color: #444;
        font-size: 0.9rem;
        padding-left: 5px;
    }

    select, button {
      padding: 14px 18px; /* More padding */
      border-radius: 10px; /* Slightly more rounded */
      border: 1px solid #e0e0e0; /* Lighter border */
      font-size: 17px; /* Slightly larger font */
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05); /* Subtle shadow */
      background-color: #ffffff; /* Ensure white background for selects */
      color: #333;
    }

    button#search-btn { /* Target specific search button */
      background: linear-gradient(45deg, rgb(0, 45, 86), rgb(0, 60, 110)); /* HUFS NAVY gradient */
      color: white;
      cursor: pointer;
      transition: all 0.3s ease; /* Smoother transition */
      border: none;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(0, 45, 86, 0.4); /* More prominent shadow */
      padding: 15px 20px; /* More padding */
      border-radius: 12px; /* More rounded */
      font-size: 18px; /* Larger font */
      font-family: 'HUFSFont', 'Noto Sans KR', sans-serif; /* Apply the new font */
    }

    button#search-btn:hover {
      background: linear-gradient(45deg, rgb(0, 60, 110), rgb(0, 45, 86)); /* Reverse gradient on hover */
      box-shadow: 0 6px 20px rgba(0, 45, 86, 0.6); /* Enhanced shadow on hover */
      transform: translateY(-2px); /* Subtle lift effect */
    }

    .building-card {
        background-color: #f8f8f8; /* Lighter background */
        border: 1px solid #eee; /* Softer border */
        border-radius: 12px; /* More rounded */
        padding: 15px 10px; /* Adjusted padding */
        cursor: pointer;
        transition: all 0.3s ease; /* Smoother transition */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 0 0 calc(33.33% - 0.66rem); /* Three columns, accounting for gap */
        max-width: calc(33.33% - 0.66rem); /* Ensure max width for three columns */
        white-space: nowrap; /* Prevent text wrapping within buttons */
        text-align: center;
        color: #555; /* Softer text color */
        font-weight: 600; /* Slightly bolder font */
        box-shadow: 0 4px 10px rgba(0,0,0,0.08); /* Softer shadow */
    }

    .building-card:hover {
        background-color: #e8e8e8; /* Lighter hover background */
        box-shadow: 0 6px 15px rgba(0,0,0,0.12); /* Enhanced hover shadow */
        transform: translateY(-2px); /* Subtle lift effect */
    }

    .building-card.selected {
        background: linear-gradient(45deg, rgb(0, 45, 86), rgb(0, 60, 110)); /* HUFS NAVY gradient */
        color: white;
        border-color: rgb(0, 45, 86); /* Matching border color */
        box-shadow: 0 4px 15px rgba(0, 45, 86, 0.4); /* Prominent shadow */
    }
    #building-checkboxes {
        display: flex;
        flex-wrap: wrap; /* Allow items to wrap to the next line */
        gap: 1rem;
        margin-top: 1rem;
        /* Removed overflow-x: auto as it's no longer needed for horizontal scrolling */
        justify-content: center; /* Center items in the container */
        padding-bottom: 5px; /* Add some padding for scrollbar */
    }
    #results {
        /* Removed grid properties */
        display: flex; /* To stack floor-rows vertically */
        flex-direction: column;
        align-items: center; /* Center the floor-rows */
        margin-top: 2rem; /* Add some top margin */
        width: 100%;
        max-width: 900px; /* Match search container width */
    }
    .floor-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, 280px); /* Changed */
        gap: 1.5rem;
        margin-top: 1rem;
        width: 100%;
        max-width: 900px;
        justify-content: center; /* Added */
    }
    .result-item {
        background: #ffffff; /* Clean white background */
        color: #333;
        padding: 1.2rem 1.8rem; /* More padding */
        border-radius: 12px; /* More rounded */
        /* margin-bottom: 1rem; Removed, replaced by grid gap */
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        box-shadow: 0 6px 20px rgba(0,0,0,0.08); /* Softer, larger shadow */
        transition: all 0.3s ease; /* Smoother transition */
        animation: fadeIn 0.5s ease-in-out;
    }
    .result-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12); /* Enhanced hover shadow */
    }
    .classroom-name {
        font-weight: 700;
        font-size: 1.3rem; /* Slightly larger font */
        color: rgb(0, 45, 86); /* HUFS NAVY */
        margin-bottom: 0.6rem;
    }
    .next-class {
        font-size: 1rem; /* Slightly larger font */
        color: #666; /* Softer text color */
        text-align: left;
        width: 100%;
    }
    .next-class-time {
        font-weight: 700;
        color: rgb(0, 100, 180); /* A lighter blue that complements HUFS NAVY */
    }
    .floor-separator {
        height: 1px;
        margin-top: 2rem;
        margin-bottom: 1.5rem;
        border: 0;
        background-image: linear-gradient(to right, rgba(141, 113, 80, 0), rgba(141, 113, 80, 0.75), rgba(141, 113, 80, 0));
        width: 100%;
    }
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    #share-all-btn {
      margin-top: 20px;
      margin-bottom: 20px; /* Added spacing */
      padding: 15px 20px;
      border-radius: 12px;
      background: #FEE500;
      color: #000000;
      font-weight: 700;
      font-size: 18px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      width: 100%;
      max-width: 900px;
    }
    #share-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }
    .footer {
      color: black;
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      position: relative;
      z-index: 1;
      margin-top: 40px; /* Add some space above the footer */
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <script>
    Kakao.init('7c1ad92f3918941cd8d0e30a84325209');
  </script>
  <div class="overlay"></div>
  <div class="content">
    <h1>HUFS<span class="gold-text">pace</span></h1>
    <p class="subtitle">í˜„ì¬ ë¹„ì–´ ìˆëŠ” ê°•ì˜ì‹¤ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.<br><span class="semester-text">[2025 - 2í•™ê¸°]</span></p>

    <div class="search-container">
        <div class="controls">
            <div class="control-group">
                <label for="day-select">ê³µê°• ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</label>
                <select id="day-select">
                    <option value="ì›”">ì›”ìš”ì¼</option>
                    <option value="í™”">í™”ìš”ì¼</option>
                    <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
                    <option value="ëª©">ëª©ìš”ì¼</option>
                    <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
                </select>
            </div>
            <div class="control-group">
                <label>ê³µê°• ì‹œê°„ëŒ€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="start-hour-select" aria-label="ì‹œì‘ ì‹œê°„"></select>
                    <select id="start-minute-select" aria-label="ì‹œì‘ ë¶„"></select>
                    <span>~</span>
                    <select id="end-hour-select" aria-label="ëë‚˜ëŠ” ì‹œê°„"></select>
                    <select id="end-minute-select" aria-label="ëë‚˜ëŠ” ë¶„"></select>
                </div>
            </div>
        </div>
        <div id="building-controls" class="control-group" style="margin-bottom: 1.5rem;">
            <label>ê²€ìƒ‰í•  ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”. (ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ì „ì²´ ê±´ë¬¼ì´ ì„ íƒë©ë‹ˆë‹¤.)</label>
            <div id="building-checkboxes">
                <!-- ê±´ë¬¼ ì²´í¬ë°•ìŠ¤ëŠ” JavaScriptë¡œ ìƒì„± -->
            </div>
        </div>
        <button id="search-btn">ë¹ˆ ê°•ì˜ì‹¤ ì°¾ê¸°</button>
    </div>
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-lHBg2akHRG7kZiQ3"
    data-ad-width = "320"
    data-ad-height = "50"></ins>
    <div id="results">
        <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>
    <button id="share-all-btn" style="display: none;"><img src="/static/kakaotalk.png" alt="KakaoTalk Share" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;">ì „ì²´ ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
    <ins class="kakao_ad_area" style="display:none;"
    data-ad-unit = "DAN-GsHTuBiNm6Sz7qAw"
    data-ad-width = "300"
    data-ad-height = "250"></ins>
    <div class="footer">
      <p>&copy; 2025 ë¦¬ì–¼ë¼ì´íŠ¸ Realright. All Rights Reserved.</p>
      <div style="margin-top: 10px; max-width: 200px; margin-left: auto; margin-right: auto;">
        <img src="/static/kakao.png" alt="Kakao Logo" style="width: 100%; height: auto;">
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const daySelect = document.getElementById('day-select');
        const startHourSelect = document.getElementById('start-hour-select');
        const startMinuteSelect = document.getElementById('start-minute-select');
        const endHourSelect = document.getElementById('end-hour-select');
        const endMinuteSelect = document.getElementById('end-minute-select');
        const searchBtn = document.getElementById('search-btn');
        const buildingCheckboxesDiv = document.getElementById('building-checkboxes');
        const resultsDiv = document.getElementById('results');

        const generateHourOptions = (selectElement) => {
            for (let h = 9; h <= 20; h++) {
                const option = document.createElement('option');
                option.value = String(h).padStart(2, '0');
                option.textContent = `${String(h).padStart(2, '0')}ì‹œ`;
                selectElement.appendChild(option);
            }
        };

        const generateMinuteOptions = (selectElement) => {
            for (let m = 0; m < 60; m += 10) {
                const option = document.createElement('option');
                option.value = String(m).padStart(2, '0');
                option.textContent = `${String(m).padStart(2, '0')}ë¶„`;
                selectElement.appendChild(option);
            }
        };

        generateHourOptions(startHourSelect);
        generateMinuteOptions(startMinuteSelect);
        generateHourOptions(endHourSelect);
        generateMinuteOptions(endMinuteSelect);

        startHourSelect.value = '10';
        startMinuteSelect.value = '00';
        endHourSelect.value = '11';
        endMinuteSelect.value = '00';

        const loadBuildings = async () => {
            const buildings = ["êµìˆ˜í•™ìŠµê°œë°œì›", "ëŒ€í•™ì›", "ë²•í•™ê´€", "ë³¸ê´€", "ì‚¬ì´ë²„ê´€", "ì‚¬íšŒê³¼í•™ê´€", "ì¸ë¬¸ê³¼í•™ê´€"];
            buildingCheckboxesDiv.innerHTML = ''; // Clear previous content

            buildings.forEach(building => {
                const card = document.createElement('div');
                card.className = 'building-card';
                card.dataset.building = building;

                const name = document.createElement('div');
                name.textContent = building;

                card.appendChild(name);

                card.addEventListener('click', () => {
                    card.classList.toggle('selected');
                });
                buildingCheckboxesDiv.appendChild(card);
            });
        };
        loadBuildings();

        searchBtn.addEventListener('click', async () => {
            const day = daySelect.value;
            const startTime = `${startHourSelect.value}:${startMinuteSelect.value}`;
            const endTime = `${endHourSelect.value}:${endMinuteSelect.value}`;

            if (startTime >= endTime) {
                alert("ê³µê°• ì‹œê°„ëŒ€ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            const selectedBuildings = Array.from(document.querySelectorAll('.building-card.selected'))
                                            .map(card => card.dataset.building)
                                            .join(',');

            resultsDiv.innerHTML = '<div class="loading-spinner"></div>';

            try {
                const url = `/find?day=${day}&startTime=${startTime}&endTime=${endTime}&buildings=${selectedBuildings}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                resultsDiv.innerHTML = ''; 

                if (data.length === 0) {
                    alert("í•´ë‹¹ ê±´ë¬¼ì— ë¹ˆ ê°•ì˜ì‹¤ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    resultsDiv.innerHTML = '';
                    document.getElementById('share-all-btn').style.display = 'none';
                } else {
                    // Sort data by classroom number to ensure correct grouping and ordering
                    data.sort((a, b) => {
                        const roomA = parseInt(a.classroom);
                        const roomB = parseInt(b.classroom);
                        return roomA - roomB;
                    });

                    let currentFloor = null;
                    let currentFloorRow = null; // To hold the current .floor-row container

                    data.forEach(room => {
                        const roomName = room.classroom; // e.g., "ì‚¬íšŒê³¼í•™ê´€ 201í˜¸"
                        const match = roomName.match(/\s(\d+)/);
                        let floor = 'N/A'; // Default floor if no number is found
                        if (match && match[1]) {
                            floor = match[1].charAt(0);
                        }

                        // If a new floor is encountered, create a new floor-row container
                        if (floor !== currentFloor) {
                            currentFloor = floor;
                            // Only add separator if it's not the very first floor
                            if (resultsDiv.children.length > 0) {
                                const floorSeparator = document.createElement('div');
                                floorSeparator.className = 'floor-separator'; // New class for visual separation
                                resultsDiv.appendChild(floorSeparator);
                            }
                            
                            currentFloorRow = document.createElement('div');
                            currentFloorRow.className = 'floor-row';
                            resultsDiv.appendChild(currentFloorRow);
                        }

                        // Create individual result-item for each classroom and append to currentFloorRow
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        
                        const nameSpan = document.createElement('div');
                        nameSpan.className = 'classroom-name';
                        nameSpan.innerHTML = `${room.classroom} <img src="/static/kakaotalk.png" alt="KakaoTalk Share" style="width: 18px; height: 18px; vertical-align: middle; margin-left: 5px;">`;

                        const nextClassDiv = document.createElement('div');
                        nextClassDiv.className = 'next-class';
                        nextClassDiv.innerHTML = `ë‹¤ìŒ ê°•ì˜: <span class="next-class-time">${room.next_class}</span>`;

                        item.appendChild(nameSpan);
                        item.appendChild(nextClassDiv);

                        item.addEventListener('click', () => {
                            Kakao.Link.sendDefault({
                                objectType: 'text',
                                text: `[HUFSpace] ${room.classroom} ì§€ê¸ˆ ë¹„ì–´ìˆì–´ìš”!\në‹¤ìŒ ê°•ì˜: ${room.next_class} ğŸ“š`,
                                link: {
                                    mobileWebUrl: 'https://hufspace.onrender.com/',
                                    webUrl: 'https://hufspace.onrender.com/',
                                },
                            });
                        });

                        currentFloorRow.appendChild(item); // Append to the current floor's row
                    });

                    // Show the share all button
                    const shareAllBtn = document.getElementById('share-all-btn');
                    shareAllBtn.style.display = 'block';
                    shareAllBtn.addEventListener('click', () => {
                        const buildingText = selectedBuildings ? `${selectedBuildings} ê¸°ì¤€` : 'ì „ì²´ ê±´ë¬¼ ê¸°ì¤€';
                        const classroomList = data.map(room => room.classroom).join(', ');
                        Kakao.Link.sendDefault({
                            objectType: 'text',
                            text: `[HUFSpace]\n${startTime}~${endTime} ê³µê°•\n${buildingText} ì´ìš© ê°€ëŠ¥í•œ ê°•ì˜ì‹¤ ${data.length}ê°œ\n${classroomList} ğŸ“š`,
                            link: {
                                mobileWebUrl: 'https://hufspace.onrender.com/',
                                webUrl: 'https://hufspace.onrender.com/',
                            },
                        });
                    });
                }
            } catch (error) {
                console.error('Fetch error:', error);
                resultsDiv.innerHTML = '<p class="no-results">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        });
    });
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(registration => {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, err => {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  </script>
  <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
</body>
</html>
